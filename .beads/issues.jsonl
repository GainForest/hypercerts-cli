{"id":"hypercerts-cli-kxi","title":"Epic: P1 bug fixes and security improvements","description":"Fix critical bugs found during code review: broken goreleaser config, wrong golangci prefix, plaintext password storage, double API calls, missing LICENSE, unhandled ErrUserAborted, and partial result loss on cancel.","status":"open","priority":1,"issue_type":"epic","owner":"newton.climateai.org","created_at":"2026-02-15T05:09:11.150260172Z","created_by":"newton.climateai.org","updated_at":"2026-02-15T05:09:11.150260172Z"}
{"id":"hypercerts-cli-kxi.1","title":"Fix .goreleaser.yaml: wrong module path, entry point, and binary name","description":"## Files\n- .goreleaser.yaml (modify)\n\n## What to do\n\nThe goreleaser config has 3 errors that prevent releases from building:\n\n1. **`main: .`** → should be `./cmd/hc` (the actual entry point)\n2. **`binary: hyper`** → should be `hc` (matches Makefile line 6, README, and actual usage)\n3. **`ldflags` path** references `github.com/hypercerts-org/hyper/cmd.Version` → should be `github.com/GainForest/hypercerts-cli/cmd.Version`\n\n### Current (broken):\n```yaml\nbuilds:\n  - main: .\n    binary: hyper\n    ldflags:\n      - -s -w -X github.com/hypercerts-org/hyper/cmd.Version={{.Version}}\n```\n\n### Fixed:\n```yaml\nbuilds:\n  - main: ./cmd/hc\n    binary: hc\n    ldflags:\n      - -s -w -X github.com/GainForest/hypercerts-cli/cmd.Version={{.Version}}\n```\n\n## Test\n\n```bash\ngrep \"main: ./cmd/hc\" .goreleaser.yaml \u0026\u0026 grep \"binary: hc\" .goreleaser.yaml \u0026\u0026 grep \"GainForest/hypercerts-cli\" .goreleaser.yaml\n```\n\nAll three greps must match (exit 0).\n\n## Dont\n- Do NOT change any other goreleaser settings (archives, changelog, etc.)\n- Do NOT run goreleaser — just fix the config","status":"open","priority":1,"issue_type":"task","owner":"newton.climateai.org","created_at":"2026-02-15T05:09:27.659492537Z","created_by":"newton.climateai.org","updated_at":"2026-02-15T05:09:27.659492537Z","labels":["scope:trivial"],"dependencies":[{"issue_id":"hypercerts-cli-kxi.1","depends_on_id":"hypercerts-cli-kxi","type":"parent-child","created_at":"2026-02-15T05:09:27.74354623Z","created_by":"newton.climateai.org"}]}
{"id":"hypercerts-cli-kxi.2","title":"Fix .golangci.yaml local-prefixes to match actual module path","description":"## Files\n- .golangci.yaml (modify)\n\n## What to do\n\nLine 14 has wrong module prefix for goimports:\n\n### Current (wrong):\n```yaml\n  goimports:\n    local-prefixes: github.com/hypercerts-org/hyper\n```\n\n### Fixed:\n```yaml\n  goimports:\n    local-prefixes: github.com/GainForest/hypercerts-cli\n```\n\n## Test\n\n```bash\ngrep \"GainForest/hypercerts-cli\" .golangci.yaml \u0026\u0026 ! grep \"hypercerts-org/hyper\" .golangci.yaml\n```\n\nMust exit 0.\n\n## Dont\n- Do NOT change any linter settings or enabled linters\n- Do NOT add or remove linters","status":"open","priority":1,"issue_type":"task","owner":"newton.climateai.org","created_at":"2026-02-15T05:09:39.921959439Z","created_by":"newton.climateai.org","updated_at":"2026-02-15T05:09:39.921959439Z","labels":["scope:trivial"],"dependencies":[{"issue_id":"hypercerts-cli-kxi.2","depends_on_id":"hypercerts-cli-kxi","type":"parent-child","created_at":"2026-02-15T05:09:39.925250188Z","created_by":"newton.climateai.org"}]}
{"id":"hypercerts-cli-kxi.3","title":"Fix fetchAttachmentsForActivity double API call","description":"## Files\n- cmd/attachment.go (modify)\n\n## What to do\n\n`fetchAttachmentsForActivity` (around line 99-128) makes two identical API calls to list all attachment records. The function calls `fetchAttachments()` (which internally calls `atproto.ListAllRecords`) and then calls `atproto.ListAllRecords` again directly.\n\n### Current (broken):\n```go\nfunc fetchAttachmentsForActivity(ctx context.Context, client *atclient.APIClient, did string, activityCID string) ([]attachmentOption, error) {\n    all, err := fetchAttachments(ctx, client, did)  // 1st API call\n    if err != nil {\n        return nil, err\n    }\n    // ... filter all by activityCID ...\n\n    entries, _ := atproto.ListAllRecords(ctx, client, did, atproto.CollectionAttachment)  // 2nd identical API call!\n    // ... uses entries for something ...\n```\n\n### Fix:\nRemove the second `ListAllRecords` call. Use the data already fetched by `fetchAttachments`. If the second call was fetching raw entries for a different purpose (e.g., to get CIDs or URIs not in the option struct), refactor `fetchAttachments` to return the needed data, or extract the raw entries from the first call.\n\nRead the function carefully to understand what data the second call provides that the first doesnt, then eliminate the redundancy.\n\n## Test\n\n```bash\nmake test\n```\n\nMust exit 0. Also verify with grep that there is only one `ListAllRecords.*CollectionAttachment` call path in the function.\n\n## Dont\n- Do NOT change the function signature\n- Do NOT change the filtering logic\n- Do NOT change other functions in attachment.go","status":"open","priority":1,"issue_type":"task","owner":"newton.climateai.org","created_at":"2026-02-15T05:09:58.728799104Z","created_by":"newton.climateai.org","updated_at":"2026-02-15T05:09:58.728799104Z","labels":["scope:small"],"dependencies":[{"issue_id":"hypercerts-cli-kxi.3","depends_on_id":"hypercerts-cli-kxi","type":"parent-child","created_at":"2026-02-15T05:09:58.733455271Z","created_by":"newton.climateai.org"}]}
{"id":"hypercerts-cli-kxi.4","title":"Add MIT LICENSE file","description":"## Files\n- LICENSE (create)\n\n## What to do\n\nThe README references a LICENSE file but none exists. Add a standard MIT license file.\n\nCreate a file called `LICENSE` in the repository root with the MIT license text. Use \"GainForest\" as the copyright holder and 2025 as the year.\n\n```\nMIT License\n\nCopyright (c) 2025 GainForest\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n```\n\n## Test\n\n```bash\ntest -f LICENSE \u0026\u0026 head -1 LICENSE | grep -q \"MIT\"\n```\n\nMust exit 0.\n\n## Dont\n- Do NOT use any other license type\n- Do NOT modify any other files","status":"open","priority":1,"issue_type":"task","owner":"newton.climateai.org","created_at":"2026-02-15T05:10:11.864686947Z","created_by":"newton.climateai.org","updated_at":"2026-02-15T05:10:11.864686947Z","labels":["scope:trivial"],"dependencies":[{"issue_id":"hypercerts-cli-kxi.4","depends_on_id":"hypercerts-cli-kxi","type":"parent-child","created_at":"2026-02-15T05:10:11.868878631Z","created_by":"newton.climateai.org"}]}
{"id":"hypercerts-cli-kxi.5","title":"Handle huh.ErrUserAborted in all interactive form .Run() calls","description":"## Files\n- cmd/activity.go (modify)\n- cmd/measurement.go (modify)\n- cmd/funding.go (modify)\n- cmd/rights.go (modify)\n- cmd/attachment.go (modify)\n- cmd/collection.go (modify)\n- cmd/evaluation.go (modify)\n- cmd/contributor.go (modify)\n- cmd/workscope.go (modify)\n\n## What to do\n\nWhen a user presses Ctrl+C during an interactive `huh` form prompt, `huh.Run()` returns `huh.ErrUserAborted`. Currently many call sites do not check for this error and propagate it as a raw error message to the user.\n\nFind every call to `.Run()` on a `huh.NewInput()`, `huh.NewText()`, `huh.NewSelect()`, `huh.NewConfirm()`, or `huh.NewForm()` in the `cmd/` package. For each one, add a check:\n\n```go\nif err := huh.NewInput().Title(\"...\").Value(\u0026val).Run(); err != nil {\n    if errors.Is(err, huh.ErrUserAborted) {\n        return fmt.Errorf(\"cancelled\")\n    }\n    return err\n}\n```\n\n### How to find all locations:\n\n```bash\ngrep -n \"\\.Run()\" cmd/*.go | grep -v \"_test.go\" | grep -v \"func \"\n```\n\nLook for patterns like:\n- `huh.NewInput().*.Run()`\n- `huh.NewText().*.Run()`\n- `huh.NewSelect().*.Run()`\n- `huh.NewForm().*.Run()`\n\nFor each, check if the error return is handled. If the error is checked but doesnt test for `ErrUserAborted`, add the check.\n\n### Import needed:\n\nAdd `\"errors\"` to the import block of each modified file (if not already present).\nAdd `\"github.com/charmbracelet/huh\"` to the import block (likely already present).\n\n## Test\n\n```bash\nmake test\n```\n\nMust exit 0.\n\n## Dont\n- Do NOT change any non-error-handling logic\n- Do NOT change the form field definitions or validation\n- Do NOT change function signatures\n- Do NOT add new interactive prompts","status":"open","priority":1,"issue_type":"task","owner":"newton.climateai.org","created_at":"2026-02-15T05:10:30.007025808Z","created_by":"newton.climateai.org","updated_at":"2026-02-15T05:10:30.007025808Z","labels":["scope:small"],"dependencies":[{"issue_id":"hypercerts-cli-kxi.5","depends_on_id":"hypercerts-cli-kxi","type":"parent-child","created_at":"2026-02-15T05:10:30.01109556Z","created_by":"newton.climateai.org"}]}
{"id":"hypercerts-cli-kxi.6","title":"Fix selectLocations to return partial results on cancel","description":"## Files\n- cmd/location.go (modify)\n\n## What to do\n\n`selectLocations` (around line 101-115) discards all previously selected locations when the user cancels during the \"add another?\" loop. If a user selects 2 locations then cancels on the 3rd, they lose everything.\n\n### Current (broken):\n```go\nfunc selectLocations(ctx context.Context, client *atclient.APIClient, w io.Writer) ([]locationOption, error) {\n    var result []locationOption\n    for {\n        loc, err := selectLocation(ctx, client, w)\n        if err != nil {\n            return nil, err  // BUG: discards partial results\n        }\n        result = append(result, *loc)\n        if !menu.Confirm(w, os.Stdin, \"Add another location?\") {\n            break\n        }\n    }\n    return result, nil\n}\n```\n\n### Fixed:\n```go\nfunc selectLocations(ctx context.Context, client *atclient.APIClient, w io.Writer) ([]locationOption, error) {\n    var result []locationOption\n    for {\n        loc, err := selectLocation(ctx, client, w)\n        if err != nil {\n            // If user cancelled and we already have some locations, return them\n            if len(result) \u003e 0 {\n                return result, nil\n            }\n            return nil, err\n        }\n        result = append(result, *loc)\n        if !menu.Confirm(w, os.Stdin, \"Add another location?\") {\n            break\n        }\n    }\n    return result, nil\n}\n```\n\n## Test\n\n```bash\nmake test\n```\n\nMust exit 0.\n\n## Dont\n- Do NOT change the selectLocation function\n- Do NOT change the menu.Confirm function\n- Do NOT change the function signature","status":"open","priority":1,"issue_type":"task","owner":"newton.climateai.org","created_at":"2026-02-15T05:10:45.284938438Z","created_by":"newton.climateai.org","updated_at":"2026-02-15T05:10:45.284938438Z","labels":["scope:trivial"],"dependencies":[{"issue_id":"hypercerts-cli-kxi.6","depends_on_id":"hypercerts-cli-kxi","type":"parent-child","created_at":"2026-02-15T05:10:45.290239209Z","created_by":"newton.climateai.org"}]}
{"id":"hypercerts-cli-kxi.7","title":"Document plaintext password storage and add warning to login output","description":"## Files\n- internal/atproto/auth.go (modify)\n- AGENTS.md (modify)\n- README.md (modify)\n\n## What to do\n\nThe app password is stored in plaintext in `~/.local/state/hc/auth-session.json`. While the file has 0600 permissions, this should be documented prominently and a warning shown at login time.\n\n### 1. Add warning comment in auth.go\n\nAdd a prominent comment above the AuthSession struct:\n\n```go\n// AuthSession stores the authentication state.\n// WARNING: The app password is stored in plaintext at ~/.local/state/hc/auth-session.json\n// with 0600 permissions. This is required for automatic token refresh.\n// Users should use ATProto app passwords (not their main password).\n// TODO: Consider OS keychain integration for password storage.\ntype AuthSession struct {\n```\n\n### 2. Print warning after successful login\n\nIn the `PersistAuthSession` function or in the login command handler, after saving the session, print:\n\n```go\nfmt.Fprintf(w, \"⚠ Session saved to %s (includes app password in plaintext)\\n\", sessionPath)\nfmt.Fprintf(w, \"  Tip: Use an ATProto app password, not your main account password\\n\")\n```\n\nFind where the login success message is printed (likely in `cmd/account.go` `runAccountLogin`) and add this warning there.\n\n### 3. Update AGENTS.md\n\nFix the session path reference (line ~229):\n- Change `~/.local/state/hyper/auth-session.json` to `~/.local/state/hc/auth-session.json`\n- Add a note about plaintext password storage\n\n### 4. Update README.md\n\nIn the authentication section, add a security note:\n\n```markdown\n\u003e **Security Note:** Your app password is stored in plaintext at `~/.local/state/hc/auth-session.json`.\n\u003e Always use an [ATProto app password](https://bsky.app/settings/app-passwords), never your main account password.\n```\n\n## Test\n\n```bash\nmake test\n```\n\nMust exit 0.\n\n## Dont\n- Do NOT change the actual storage mechanism (that would be a larger refactor)\n- Do NOT remove the password from the session file (it is needed for token refresh)\n- Do NOT change the file permissions (0600 is correct)","status":"open","priority":1,"issue_type":"task","owner":"newton.climateai.org","created_at":"2026-02-15T05:11:05.602644846Z","created_by":"newton.climateai.org","updated_at":"2026-02-15T05:11:05.602644846Z","labels":["scope:small"],"dependencies":[{"issue_id":"hypercerts-cli-kxi.7","depends_on_id":"hypercerts-cli-kxi","type":"parent-child","created_at":"2026-02-15T05:11:05.605933182Z","created_by":"newton.climateai.org"}]}
